{
  "workflow_examples": [
    {
      "name": "Lead Source Deactivation → Create Task",
      "description": "When a lead source is deactivated, create a task to review affected leads",
      "trigger_data": {
        "operation": "UPDATE",
        "table": "lead_sources",
        "before": {
          "code": "SOCIAL_MEDIA",
          "name": "Social Media Campaign",
          "is_active": true
        },
        "after": {
          "code": "SOCIAL_MEDIA",
          "name": "Social Media Campaign",
          "is_active": false
        }
      },
      "task_action_config": {
        "operation": "create",
        "title": "Review leads from deactivated source: {{variable.after.name}}",
        "description": "The lead source '{{variable.after.name}}' ({{variable.after.code}}) was deactivated on {{variable.timestamp}}. Please review all leads from this source and reassign them to active sources.",
        "status": "pending",
        "priority": "high",
        "dueDateDynamic": "+1d",
        "entityType": "crm_leads",
        "additionalData": {
          "deactivated_source": "{{variable.after.code}}",
          "deactivation_date": "{{variable.timestamp}}",
          "previous_name": "{{variable.before.name}}"
        }
      },
      "expected_result": {
        "success": true,
        "operation": "create",
        "data": {
          "id": "task-uuid-123",
          "title": "Review leads from deactivated source: Social Media Campaign",
          "description": "The lead source 'Social Media Campaign' (SOCIAL_MEDIA) was deactivated on 2024-01-15T14:30:00Z. Please review all leads from this source and reassign them to active sources.",
          "status": "pending",
          "priority": "high",
          "dueDate": "2024-01-16T14:30:00Z"
        }
      }
    },
    {
      "name": "High-Value Lead Created → Assign Task",
      "description": "When a high-value lead is created, assign a follow-up task to the sales team",
      "trigger_data": {
        "operation": "INSERT",
        "table": "crm_leads",
        "after": {
          "id": "lead-456",
          "name": "John Doe",
          "email": "john@company.com",
          "phone": "+1-555-123-4567",
          "lead_score": 95,
          "source": "WEB_FORM",
          "status": "new",
          "assigned_to": "sales-user-789"
        }
      },
      "workflow_filter": {
        "combinator": "AND",
        "conditions": [
          {
            "variable": "{{variable.operation}}",
            "operator": "equals",
            "value": "INSERT"
          },
          {
            "variable": "{{variable.after.lead_score}}",
            "operator": "greater_than",
            "value": 80
          }
        ]
      },
      "task_action_config": {
        "operation": "create",
        "title": "URGENT: Follow up with high-value lead {{variable.after.name}}",
        "description": "High-value lead (Score: {{variable.after.lead_score}}) needs immediate attention.\n\nLead Details:\n- Name: {{variable.after.name}}\n- Email: {{variable.after.email}}\n- Phone: {{variable.after.phone}}\n- Source: {{variable.after.source}}\n\nPlease contact within 1 hour.",
        "status": "pending",
        "priority": "urgent",
        "dueDateDynamic": "+1h",
        "entityType": "crm_leads",
        "entityId": "{{variable.after.id}}",
        "assignedTo": "{{variable.after.assigned_to}}",
        "additionalData": {
          "lead_score": "{{variable.after.lead_score}}",
          "source": "{{variable.after.source}}",
          "urgency_reason": "high_lead_score"
        }
      },
      "expected_result": {
        "success": true,
        "operation": "create",
        "data": {
          "id": "task-urgent-456",
          "title": "URGENT: Follow up with high-value lead John Doe",
          "status": "pending",
          "priority": "urgent",
          "entityType": "crm_leads",
          "entityId": "lead-456",
          "assignedTo": "sales-user-789"
        }
      }
    },
    {
      "name": "Overdue Tasks → Update Status",
      "description": "Daily workflow to update overdue tasks to 'expired' status",
      "trigger_data": {
        "operation": "SCHEDULE",
        "cron": "0 0 * * *",
        "timestamp": "2024-01-15T00:00:00Z"
      },
      "task_action_config": {
        "operation": "list",
        "filters": {
          "status": ["pending", "in_progress"],
          "dueDateTo": "{{variable.timestamp}}"
        },
        "limit": 1000
      },
      "follow_up_actions": [
        {
          "for_each_task": {
            "operation": "update",
            "taskId": "{{item.id}}",
            "status": "expired",
            "additionalData": {
              "expired_on": "{{variable.timestamp}}",
              "original_due_date": "{{item.dueDate}}"
            }
          }
        }
      ]
    },
    {
      "name": "Lead Status Change → Update Task",
      "description": "When a lead status changes to 'converted', mark related tasks as completed",
      "trigger_data": {
        "operation": "UPDATE",
        "table": "crm_leads",
        "before": {
          "id": "lead-789",
          "status": "qualified"
        },
        "after": {
          "id": "lead-789",
          "status": "converted",
          "converted_at": "2024-01-15T16:30:00Z"
        }
      },
      "workflow_filter": {
        "combinator": "AND",
        "conditions": [
          {
            "variable": "{{variable.operation}}",
            "operator": "equals",
            "value": "UPDATE"
          },
          {
            "variable": "{{variable.after.status}}",
            "operator": "equals",
            "value": "converted"
          },
          {
            "variable": "{{variable.before.status}}",
            "operator": "not_equals",
            "value": "converted"
          }
        ]
      },
      "task_action_config": {
        "operation": "list",
        "filters": {
          "entityType": "crm_leads",
          "entityId": "{{variable.after.id}}",
          "status": ["pending", "in_progress"]
        }
      },
      "follow_up_actions": [
        {
          "for_each_task": {
            "operation": "update",
            "taskId": "{{item.id}}",
            "status": "completed",
            "description": "Auto-completed: Lead converted on {{variable.after.converted_at}}",
            "additionalData": {
              "auto_completed": true,
              "completion_reason": "lead_converted",
              "converted_at": "{{variable.after.converted_at}}"
            }
          }
        }
      ]
    }
  ],

  "variable_interpolation_examples": {
    "description": "Examples of how workflow variables are used in task fields",
    "examples": [
      {
        "field": "title",
        "template": "Follow up with {{variable.lead_name}} from {{variable.lead_source}}",
        "variables": {
          "lead_name": "John Doe",
          "lead_source": "Website Form"
        },
        "result": "Follow up with John Doe from Website Form"
      },
      {
        "field": "description",
        "template": "Lead Score: {{variable.lead_score}}\nPhone: {{variable.lead_phone}}\nEmail: {{variable.lead_email}}\n\nNext steps:\n1. Call within 24 hours\n2. Send proposal if interested",
        "variables": {
          "lead_score": 85,
          "lead_phone": "+1-555-123-4567",
          "lead_email": "john@company.com"
        },
        "result": "Lead Score: 85\nPhone: +1-555-123-4567\nEmail: john@company.com\n\nNext steps:\n1. Call within 24 hours\n2. Send proposal if interested"
      },
      {
        "field": "additionalData",
        "template": "{\"lead_score\": {{variable.lead_score}}, \"source\": \"{{variable.lead_source}}\", \"priority_reason\": \"{{variable.priority_reason}}\"}",
        "variables": {
          "lead_score": 95,
          "lead_source": "referral",
          "priority_reason": "high_value_lead"
        },
        "result": {
          "lead_score": 95,
          "source": "referral",
          "priority_reason": "high_value_lead"
        }
      }
    ]
  },

  "conditional_logic_examples": {
    "description": "Examples of conditional task creation based on incoming data",
    "examples": [
      {
        "name": "Priority Based on Lead Score",
        "logic": "IF lead_score > 80 THEN priority = 'urgent', due_date = +1h\nELSE IF lead_score > 60 THEN priority = 'high', due_date = +4h\nELSE priority = 'medium', due_date = +1d",
        "implementation": {
          "priority": "{{variable.lead_score > 80 ? 'urgent' : variable.lead_score > 60 ? 'high' : 'medium'}}",
          "dueDateDynamic": "{{variable.lead_score > 80 ? '+1h' : variable.lead_score > 60 ? '+4h' : '+1d'}}"
        }
      },
      {
        "name": "Task Type Based on Lead Source",
        "logic": "Different task templates based on lead source",
        "implementation": {
          "title": "{{variable.lead_source === 'referral' ? 'PRIORITY: Referral follow-up' : variable.lead_source === 'website' ? 'Website lead follow-up' : 'General lead follow-up'}} - {{variable.lead_name}}"
        }
      }
    ]
  }
}
