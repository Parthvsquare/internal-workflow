{
  "name": "Lead Status Change to Task Creation",
  "description": "Automatically create follow-up tasks when lead status changes to 'contacted'",
  "segment": "CRM",
  "trigger": {
    "triggerKey": "lead_database_change",
    "properties": {
      "table_name": "leads",
      "change_type": ["UPDATE"],
      "monitor_fields": ["status"],
      "status_change_only": true,
      "debezium_config": {
        "connector_name": "leads-connector",
        "topic_pattern": "dbserver1.public.leads",
        "consumer_group": "workflow-engine"
      }
    },
    "filters": {
      "combinator": "AND",
      "conditions": [
        {
          "variable": "{{variable.after_status}}",
          "operator": "equals",
          "value": "contacted",
          "type": "string"
        },
        {
          "variable": "{{variable.before_status}}",
          "operator": "not_equals",
          "value": "contacted",
          "type": "string"
        }
      ]
    }
  },
  "steps": [
    {
      "name": "Create Follow-up Task",
      "kind": "ACTION",
      "actionKey": "taskManagement",
      "configuration": {
        "resource": "task",
        "operation": "create",
        "parameters": {
          "title": "Follow up with {{variable.after_name}}",
          "description": "Lead status changed from {{variable.before_status}} to {{variable.after_status}}. Follow up within 24 hours.",
          "status": "pending",
          "entityType": "crm_leads",
          "dueDate": "{{$now().plus(1, 'day').toISOString()}}",
          "entityId": "{{variable.after_id}}"
        }
      }
    }
  ],
  "edges": [
    {
      "fromStep": "trigger",
      "toStep": "Create Follow-up Task",
      "branchKey": "default"
    }
  ],
  "isActive": true
}
